{#
  Renders a toaster container and individual toast messages.
  Can render the initial container or be used with htmx OOB swaps to add toasts dynamically.

  @param id {string} [optional] [default="toaster"] - Unique identifier for the toaster container.
  @param toasts {array} [optional] - An array of toast objects to render initially. See the <code>toast()</code> macro for more details.
  @param main_attrs {object} [optional] - Additional HTML attributes for the main toaster container div.
  @param is_fragment {boolean} [optional] [default=false] - If true, renders only the toast elements with hx-swap-oob="beforeend", suitable for htmx responses. Skips script and template inclusion.
#}
{% macro toaster(
  id="toaster",
  toasts=[],
  attrs=None
) %}
<div
  id="{{ id }}"
  class="toaster"
  {% for key, value in attrs %}
    {{ key }}="{{ value }}"
  {% endfor %}
>
{% for item in toasts %}
  {{ toast(
    category=item.category,
    title=item.title,
    description=item.description,
    action=item.action,
    cancel=item.cancel
  ) }}
{% endfor %}
</div>
{% endmacro %}

{#
  Renders a single toast message.

  @param category {string} [optional] [default="success"] - Type of toast ('success', 'error', 'info', 'warning'). Determines icon and ARIA role.
  @param title {string} [optional] - The main title text of the toast.
  @param description {string} [optional] - The secondary description text.
  @param action {object} [optional] - Defines an action button.
    - label {string}: Button text.
    - click {string}: JavaScript code to execute on click (e.g., '$dispatch(\'custom-event\')').
    - url {string}: URL for an anchor link button.
  @param cancel {object} [optional] - Defines a cancel/dismiss button (similar structure to action).
    - label {string}: Button text.
    - click {string}: JavaScript code to execute on click (e.g., '$dispatch(\'custom-event\')').
    - url {string}: URL for an anchor link button.
#}
{% macro toast(
  category="success",
  title="",
  description="",
  action=None,
  cancel=None
) %}
<div
  class="toast"
  role="{{ 'alert' if category == 'error' else 'status' }}"
  aria-atomic="true"
  aria-hidden="false"
  {% if category %}data-category="{{ category }}"{% endif %}
>
  <div class="toast-content">
    {% if category in ["error", "success", "info", "warning"] %}
      {% if category == "success" %}
        {% lucide "circle-check" %}
      {% elif category == "error" %}
        {% lucide "circle-x" %}
      {% elif category == "info" %}
        {% lucide "info" %}
      {% elif category == "warning" %}
        {% lucide "triangle-alert" %}
      {% endif %}
    {% endif %}
    <section>
      {% if title %}<h2>{{ title }}</h2>{% endif %}
      {% if description %}<p>{{ description }}</p>{% endif %}
    </section>
    {% if action or cancel %}
      <footer>
        {% if action %}
          {% if action.href %}
            <a
              href="{{ action.href }}"
              class="btn-sm"
              data-toast-action
            >{{ action.label }}</a>
          {% else %}
            <button
              type="button"
              class="btn"
              data-toast-action
              {% if action.onclick %}onclick="{{ action.onclick }}"{% endif %}
            >{{ action.label }}</button>
          {% endif %}
        {% endif %}
        {% if cancel %}
          <button
            type="button"
            class="btn-sm-outline"
            data-toast-cancel
            {% if cancel.onclick %}onclick="{{ cancel.onclick }}"{% endif %}
          >{{ cancel.label }}</button>
        {% endif %}
      </footer>
    {% endif %}
  </div>
</div>
{% endmacro %}